<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <meta charset="UTF-8">
    <title>Signature Generator</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 700px;
            margin: auto;
            padding: 0 10px;
            display: none;
        }

        .style-label {
            margin-top: 14px;
        }

        h2 {
            text-align: center;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            font-weight: bold;
        }

        #result {
            margin-top: 20px;
            padding: 15px 15px 15px 0px;
            border: 1px solid #ccc;
            overflow-x: auto;
            background-color: #fdfdfd;
        }

        @media (max-width: 480px) {

            input,
            select,
            button {
                font-size: 14px;
            }

            #result {
                font-size: 13px;
            }
        }

        .copy-icon {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            min-width: 100px;
        }

        .container-login {
            width: 30%;
            border: 1px solid #ffff;
            padding: 20px;
            position: absolute;
            left: 35%;
            right: 35%;
            top: 25%;
            box-shadow: 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .warning-style {
            color: red;
        }

        .container-logout {
            display: flex;
            justify-content: end;
        }

        .wrap-logout {
            width: 10%;
        }

        .logout-style {
            background-color: #ffff;
            color: #000;
            border: 1px solid #ffff;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px;
        }
    </style>
</head>

<body>
    <div class="container-login">
        <div id="loginSection" style="text-align: center;">
            <h2 style="margin-bottom: 10%;">Đăng nhập với google</h2>
            <div id="myCustomGoogleBtn" style="display: flex;justify-content: center;"></div>
        </div>
    </div>

    <div class='container-logout' id="logout-id">
        <div class="wrap-logout">
            <button class="logout-style" onclick="logout()">Đăng xuất</button>
        </div>
    </div>

    <div class="container">
        <div style="text-align: center;">
            <div style="font-size: 25px;font-weight: bold;margin-bottom: 20px;" id="title-page">Tạo chữ ký email</div>
        </div>
        <label>Họ tên</label>
        <input id="name" type="text" placeholder="Nguyễn Văn A" oninput="onChangeName(this.value)" />
        <div id="warning-name" class="warning-style">lưu ý thông tin Họ tên chưa điền</div>
        <div style="height: 10px;"></div>

        <label class="style-label">Chức danh</label>
        <input id="title" type="text" placeholder="ví dụ: HR, NKCentral Group" oninput="onChangeTitle(this.value)" />
        <div id="warning-title" class="warning-style">lưu ý thông tin Chức danh chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Số điện thoại</label>
        <input id="phone" type="text" placeholder="0334123456" oninput="onChangePhone(this.value)" maxlength="10" />
        <div id="warning-phone" class="warning-style">lưu ý thông tin SĐT chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Email công ty</label>
        <input id="email" type="text" placeholder="ten@nkcmc.com.vn" oninput="onChangeEmail(this.value)" />
        <div id="warning-email" class="warning-style">lưu ý thông tin email chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Website</label>
        <input id="website" type="text" placeholder="https://nkmc.com.vn, https://galaxy365.vn"
            oninput="onChangeWebsite(this.value)" />
        <div id="warning-website" class="warning-style">lưu ý thông tin website chưa điền</div>

        <div id="resultSection" style="display:none; margin-top: 30px;">
            <div>
                <h3 style="margin: 0 0 10px 0;">Chữ ký đã được tạo thành công</h3>
                <div style="display: flex;">
                    <div>
                        <button class="copy-icon" onclick="copySignature()">Sao chép</button>
                    </div>
                    <!-- <div style="margin-left: 15px;">
                        <button class="copy-icon" onclick="copyRawHTML()">Sao chép cho
                            outlook (classic)</button>
                    </div> -->
                    <div style="margin-left: 15px;">
                        <button class="copy-icon" onclick="downloadSignatureImage()">Tải hình
                            ký</button>
                    </div>
                </div>
                <span id="copyStatus" style="font-weight: bold; color: green;font-size: 13px;"></span>

            </div>
            <div id="result" style="margin-top: 12px;">
                <div id="signatureContent"></div>
            </div>
        </div>
    </div>

    <script src="staffList.js"></script>

    <script>
        let userEmail = localStorage.getItem("userEmail") || "";
        let defaultWebsite = localStorage.getItem("websiteDomain") || "";
        let errorEmail = "false";
        const locationCompany = "No. 22, D7 Street, Saigon Pearl Villa Area, Thanh My Tay Ward, Ho Chi Minh City, Vietnam";

        function handleCredentialResponse(response) {
            const payload = parseJwt(response.credential);
            const allowedDomains = ["@nkmc.com.vn", "@blissdigital.asia", "@scnetwork.vn"];

            userEmail = payload.email ?? "";
            defaultWebsite = payload.hd ?? "";
            const isAllowed = allowedDomains.some(domain => userEmail.endsWith(domain));

            if (!isAllowed) {
                alert("Chỉ các email @nkmc.com.vn , @blissdigital.asia, @scnetwork.vn mới được phép truy cập.");
                logout();
                return;
            }
            localStorage.setItem("userEmail", userEmail);
            localStorage.setItem("name", payload.name);
            localStorage.setItem("websiteDomain", defaultWebsite);

            showSignatureForm();
        }

        function showSignatureForm() {
            document.querySelector('.wrap-logout').style.display = 'block';

            const name = localStorage.getItem("name") || "";

            const titlePage = document.getElementById('title-page');
            if (userEmail.endsWith("@nkmc.com.vn")) {
                titlePage.innerText = "Tạo chữ ký email cho NKC";
            } else if (userEmail.endsWith("@blissdigital.asia")) {
                titlePage.innerText = "Tạo chữ ký email cho Bliss Digital";
            } else if (userEmail.endsWith("@scnetwork.vn")) {
                titlePage.innerText = "Tạo chữ ký email cho PSC Media";
            } else {
                titlePage.innerText = "Tạo chữ ký email";
            }

            document.querySelector('.container-login').style.display = 'none';
            document.querySelector('.container').style.display = 'block';

            document.getElementById('name').value = name;
            document.getElementById('email').value = userEmail;
            document.getElementById('title').value = "";
            document.getElementById('phone').value = "";
            document.getElementById('website').value = defaultWebsite;

            generate();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        window.onload = function () {
            defaultStyleWarning();
            document.querySelector('.container').style.display = 'none';
            document.querySelector('.wrap-logout').style.display = 'none';

            if (userEmail) {
                showSignatureForm();
                return;
            }

            const container = document.getElementById("myCustomGoogleBtn");
            const width = Math.min(container.offsetWidth, 300);

            google.accounts.id.disableAutoSelect();
            google.accounts.id.initialize({
                client_id: "394229224916-r38l498o87h3s6j4980i4moeq6kng15h.apps.googleusercontent.com",
                callback: handleCredentialResponse,
                auto_select: false,
                prompt_parent_id: "myCustomGoogleBtn"
            });

            google.accounts.id.renderButton(
                document.getElementById("myCustomGoogleBtn"),
                {
                    theme: "outline",
                    size: "large",
                }
            );
        };

        function generate() {
            const name = document.getElementById('name').value;
            const title = document.getElementById('title').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const websiteRaw = document.getElementById('website').value;

            const websiteList = websiteRaw.split(',').map(link => link.trim()).filter(link => link.length > 0);
            checkValidation(name, title, phone, email, websiteRaw);
            const websiteHTML = websiteList.map(link => {
                const safeLink = link.startsWith('http://') || link.startsWith('https://') ? link : 'https://' + link;
                return `<a href="${safeLink}" target="_blank" style="color:#1a73e8; text-decoration:none; font-size: 14px;">&nbsp${safeLink}&nbsp</a>`;
            }).join('/');

            let html = "";
            if (userEmail.endsWith("@nkmc.com.vn")) {
                html = genSignatureNKCentral(name, title, phone, email, websiteHTML);
            } else if (userEmail.endsWith("@blissdigital.asia")) {
                html = genSignatureBlissDigital(name, title, phone, email, websiteHTML);
            } else if (userEmail.endsWith("@scnetwork.vn")) {
                html = genSignaturePSCMedia(name, title, phone, email, websiteHTML);
            } else {
                html = `<div style="color:red;">Email không thuộc các domain được hỗ trợ!</div>`;
            }

            document.getElementById('signatureContent').innerHTML = html;
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('copyStatus').innerText = '';
        }

        function copySignature() {
            const htmlContent = document.getElementById("signatureContent").innerHTML;

            const blob = new Blob([htmlContent], { type: "text/html" });
            const data = [new ClipboardItem({ "text/html": blob })];

            navigator.clipboard.write(data).then(() => {
                document.getElementById("copyStatus").innerText = "Đã sao chép!";
            }).catch(err => {
                console.error("Lỗi sao chép:", err);
                document.getElementById("copyStatus").innerText = "Không thể sao chép.";
            });
        }

        function copyRawHTML() {
            const htmlContent = document.getElementById("signatureContent").innerHTML;

            const textArea = document.createElement("textarea");
            textArea.value = htmlContent;
            document.body.appendChild(textArea);

            textArea.select();
            textArea.setSelectionRange(0, 99999);

            try {
                document.execCommand("copy");
                document.getElementById("copyStatus").innerText =
                    "Đã sao chép! Truy cập C:\\Users\\${tennguoidung}\\AppData\\Roaming\\Microsoft\\Signatures để thêm chữ ký";
            } catch (err) {
                console.error("Không thể sao chép HTML:", err);
                document.getElementById("copyStatus").innerText = "Không thể sao chép.";
            }

            document.body.removeChild(textArea);
        }

        function downloadSignatureImage() {
            const signatureElement = document.getElementById("signatureContent");

            html2canvas(signatureElement, {
                backgroundColor: null,
                scale: 2,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement("a");
                link.download = "signature.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(error => {
                console.error("Lỗi khi tạo ảnh:", error);
                alert("Không thể tải ảnh chữ ký. Vui lòng thử lại.");
            });
        }


        function defaultStyleWarning() {
            document.getElementById('warning-name').style.display = 'none';
            document.getElementById('warning-title').style.display = 'none';
            document.getElementById('warning-phone').style.display = 'none';
            document.getElementById('warning-email').style.display = 'none';
            document.getElementById('warning-website').style.display = 'none';
        }

        function checkValidation(name, title, phone, email, websiteRaw) {
            if (name === "") {
                document.getElementById('warning-name').style.display = 'block';
            }
            if (title === "") {
                document.getElementById('warning-title').style.display = 'block';
            }
            if (phone === "") {
                document.getElementById('warning-phone').style.display = 'block';
            }
            if (email === "") {
                document.getElementById('warning-email').style.display = 'block';
            }
            if (websiteRaw === "") {
                document.getElementById('warning-website').style.display = 'block';
            }
        }

        function onChangePhone(value) {
            const phoneValue = value.trim();
            const warningPhone = document.getElementById('warning-phone');
            if (phoneValue === "") {
                warningPhone.style.display = 'block';
                warningPhone.innerText = "lưu ý thông tin SĐT chưa điền";
            }
            warningPhone.style.display = 'none';
            const phoneRegex = /^0\d{9}$/;

            if (phoneValue !== "" && !phoneRegex.test(phoneValue)) {
                warningPhone.style.display = 'block';
                warningPhone.innerText = "Số điện thoại không hợp lệ. Vui lòng nhập đúng 10 chữ số và bắt đầu bằng 0.";
            }
            generate();
        }

        function onChangeEmail(value) {
            const mailValue = value.trim();
            const warningEmail = document.getElementById('warning-email');
            if (mailValue === "") {
                warningEmail.style.display = 'block';
                warningEmail.innerText = "lưu ý thông tin Email chưa điền";
                errorEmail = "true";
            } else {
                errorEmail = "false";
            }
            warningEmail.style.display = 'none';
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (mailValue !== "" && !emailRegex.test(mailValue)) {
                warningEmail.style.display = 'block';
                warningEmail.innerText = "Vui lòng nhập đúng định dạng email.";
                errorEmail = "true";
            } else {
                errorEmail = "false";
            }
            generate();
        }

        function onChangeName(value) {
            const nameValue = value.trim();
            const warningName = document.getElementById('warning-name');
            if (nameValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Họ tên chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        function onChangeTitle(value) {
            const titleValue = value.trim();
            const warningName = document.getElementById('warning-title');
            if (titleValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Chức danh chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        function onChangeWebsite(value) {
            const websiteValue = value.trim();
            const warningName = document.getElementById('warning-website');
            if (websiteValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Website chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        function genSignatureNKCentral(name, title, phone, email, websiteHTML) {
            return `
                <table cellpadding="0" cellspacing="0" style="font-family: Arial, Helvetica, sans-serif; color: #333333; border-collapse: collapse; width: 100%; max-width: 600px;">
                    <tr>
                        <td align="center" valign="middle"">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/Logo_NK.png" alt="NKC Logo" width="120" style="display: block; border: 0; pointer-events: none; user-select: none;">
                        </td>
                        <td valign="top" style="border-left: 2px solid #fade70; padding: 10px 0 10px 15px;">
                            ${name.trim() !== "" ? `<div style="font-size: 18px; font-weight: bold; color: #333333; margin-bottom: 6px;">${name}</div>` : ""}
                            ${title.trim() !== "" ? `<div style="font-size: 14px; color: #555555; font-weight: bold; margin-bottom: 12px;">${title}</div>` : ""}
                            ${(phone.trim() !== "" && phone.length === 10) ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/phone.png" alt="Phone" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="tel:${phone}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${phone}</a>
                            </div>` : ""}
                            ${(email.trim() !== "" && errorEmail === "false") ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/email.png" alt="Email" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="mailto:${email}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${email}</a>
                            </div>` : ""}
                            ${websiteHTML.trim() !== "" ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/main/web-icon.png" alt="Website" width="16"  style="vertical-align: middle; border: 0;">
                                ${websiteHTML}
                            </div>` : ""}
                            <div style="font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/location.png" alt="Location" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="https://maps.google.com/?q=${locationCompany}" target="_blank" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${locationCompany}</a>
                            </div>
                        </td>
                    </tr>
                </table>`;
        }

        function genSignatureBlissDigital(name, title, phone, email, websiteHTML) {
            return `
                <table cellpadding="0" cellspacing="0" style="font-family: Arial, Helvetica, sans-serif; color: #333333; border-collapse: collapse; width: 100%; max-width: 600px;">
                    <tr>
                        <td align="center" valign="middle" style="padding: 0px 10px 0px 10px">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/BLISS-LOGO_Official.png" alt="BLISS Logo" width="120" style="display: block; border: 0; pointer-events: none; user-select: none;">
                        </td>
                        <td valign="top" style="border-left: 2px solid #fade70; padding: 10px 0 10px 15px;">
                            ${name.trim() !== "" ? `<div style="font-size: 18px; font-weight: bold; color: #333333; margin-bottom: 6px;">${name}</div>` : ""}
                            ${title.trim() !== "" ? `<div style="font-size: 14px; color: #555555; font-weight: bold; margin-bottom: 12px;">${title}</div>` : ""}
                            ${(phone.trim() !== "" && phone.length === 10) ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/phone.png" alt="Phone" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="tel:${phone}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${phone}</a>
                            </div>` : ""}
                            ${(email.trim() !== "" && errorEmail === "false") ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/email.png" alt="Email" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="mailto:${email}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${email}</a>
                            </div>` : ""}
                            ${websiteHTML.trim() !== "" ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/main/web-icon.png" alt="Website" width="16"  style="vertical-align: middle; border: 0;">
                                ${websiteHTML}
                            </div>` : ""}
                            <div style="font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/location.png" alt="Location" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="https://maps.google.com/?q=${locationCompany}" target="_blank" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${locationCompany}</a>
                            </div>
                        </td>
                    </tr>
                </table>`;
        }

        function genSignaturePSCMedia(name, title, phone, email, websiteHTML) {
            return `
                <table cellpadding="0" cellspacing="0" style="font-family: Arial, Helvetica, sans-serif; color: #333333; border-collapse: collapse; width: 100%; max-width: 600px;">
                    <tr>
                        <td align="center" valign="middle" style="padding: 0px 10px 0px 10px">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/psc-media.png" alt="PSC Logo" width="120" style="display: block; border: 0; pointer-events: none; user-select: none;">
                        </td>
                        <td valign="top" style="border-left: 2px solid #3d3d3d; padding: 10px 0 10px 15px;">
                            ${name.trim() !== "" ? `<div style="font-size: 18px; font-weight: bold; color: #333333; margin-bottom: 6px;">${name}</div>` : ""}
                            ${title.trim() !== "" ? `<div style="font-size: 14px; color: #555555; font-weight: bold; margin-bottom: 12px;">${title}</div>` : ""}
                            ${(phone.trim() !== "" && phone.length === 10) ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/phone.png" alt="Phone" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="tel:${phone}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${phone}</a>
                            </div>` : ""}
                            ${(email.trim() !== "" && errorEmail === "false") ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/email.png" alt="Email" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="mailto:${email}" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${email}</a>
                            </div>` : ""}
                            ${websiteHTML.trim() !== "" ? `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/main/web-icon.png" alt="Website" width="16"  style="vertical-align: middle; border: 0;">
                                ${websiteHTML}
                            </div>` : ""}
                            <div style="font-size: 14px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/location.png" alt="Location" width="16"  style="vertical-align: middle; border: 0;">
                                &nbsp<a href="https://maps.google.com/?q=${locationCompany}" target="_blank" style="color: #1a73e8; text-decoration: none; font-size: 14px;">${locationCompany}
                                </a>
                            </div>
                        </td>
                    </tr>
                </table>`;
        }

        function logout() {
            google.accounts.id.disableAutoSelect();
            document.querySelector('.wrap-logout').style.display = 'none';
            localStorage.removeItem("userEmail");
            localStorage.removeItem("name");
            localStorage.removeItem("websiteDomain");
            location.reload();
        }
    </script>
</body>

</html>
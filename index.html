<!DOCTYPE html>
<html lang="vi">

<head>
    <script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <meta charset="UTF-8">
    <title>NKC Email Signature Generator</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 700px;
            margin: auto;
            padding: 0 10px;
            display: block;

            .style-label {
                margin-top: 14px;
            }
        }

        h2 {
            text-align: center;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            font-weight: bold;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            overflow-x: auto;
            background-color: #fdfdfd;
        }

        @media (max-width: 480px) {

            input,
            select,
            button {
                font-size: 14px;
            }

            #result {
                font-size: 13px;
            }
        }

        .copy-icon {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .container-login {
            width: 40%;
            border: 1px solid #ffff;
            padding: 20px;
            position: absolute;
            left: 30%;
            right: 30%;
            top: 25%;
            box-shadow: 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .warning-style {
            color: red;
        }
    </style>
</head>

<body>
    <div class="container-login">
        <div id="loginSection" style="text-align: center;">
            <h2 style="margin-bottom: 10%;">Đăng nhập với google</h2>
            <div id="myCustomGoogleBtn" style="display: flex;justify-content: center;"></div>
        </div>
    </div>


    <div class="container">
        <div style="text-align: center;">
            <h2>Tạo chữ ký email</h2>
        </div>
        <!-- Vẫn cần giữ lại để autofill hoạt động -->
        <label>Họ tên</label>
        <input id="name" type="text" placeholder="Nguyễn Văn A" oninput="onChangeName(this.value)" />
        <div id="warning-name" class="warning-style">lưu ý thông tin Họ tên chưa điền</div>
        <div style="height: 10px;"></div>

        <label class="style-label">Chức danh</label>
        <input id="title" type="text" placeholder="ví dụ: HR, NKCentral Group" oninput="onChangeTitle(this.value)" />
        <div id="warning-title" class="warning-style">lưu ý thông tin Chức danh chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Số điện thoại</label>
        <input id="phone" type="text" placeholder="0334123456" oninput="onChangePhone(this.value)" />
        <div id="warning-phone" class="warning-style">lưu ý thông tin SĐT chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Email công ty</label>
        <input id="email" type="text" placeholder="ten@nkcmc.com.vn" oninput="onChangeEmail(this.value)" />
        <div id="warning-email" class="warning-style">lưu ý thông tin email chưa điền</div>

        <div style="height: 10px;"></div>
        <label class="style-label">Website</label>
        <input id="website" type="text" placeholder="https://nkmc.com.vn, https://galaxy365.vn"
            oninput="onChangeWebsite(this.value)" />
        <div id="warning-website" class="warning-style">lưu ý thông tin website chưa điền</div>

        <!-- <button onclick="generate()">Tạo chữ ký</button> -->

        <div id="resultSection" style="display:none; margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <h3 style="margin: 0 0 10px 0;">Chữ ký đã được tạo thành công</h3>
                <div>
                    <button class="copy-icon" onclick="copySignature()">Sao chép</button>
                    <span id="copyStatus" style="margin-left: 8px; font-weight: bold; color: green;"></span>
                </div>
            </div>
            <div id="result" contenteditable="true" style="margin-top: 12px;"></div>
        </div>
    </div>

    <script src="staffList.js"></script>

    <script>
        function handleCredentialResponse(response) {
            const payload = parseJwt(response.credential);

            // Ẩn phần login, hiển thị phần chính
            document.getElementById('loginSection').style.display = 'none';
            document.querySelector('.container-login').style.display = 'none';
            document.querySelector('.container').style.display = 'block';

            document.getElementById('name').value = payload.name ?? "";
            document.getElementById('title').value = "";
            document.getElementById('phone').value = "";
            document.getElementById('email').value = payload.email ?? "";
            document.getElementById('website').value = "https://nkmc.com.vn";

            generate();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // Populate selectbox khi load trang
        window.onload = function () {
            defaultStyleWarning();
            document.querySelector('.container').style.display = 'none';
            const container = document.getElementById("myCustomGoogleBtn");
            const width = Math.min(container.offsetWidth, 350);

            google.accounts.id.disableAutoSelect();
            google.accounts.id.initialize({
                client_id: "394229224916-r38l498o87h3s6j4980i4moeq6kng15h.apps.googleusercontent.com",
                callback: handleCredentialResponse,
                auto_select: false,
                prompt_parent_id: "myCustomGoogleBtn"
            });

            google.accounts.id.renderButton(
                document.getElementById("myCustomGoogleBtn"),
                {
                    theme: "outline",
                    size: "large",
                    width: width,
                }
            );
        };

        function generate() {
            const name = document.getElementById('name').value;
            const title = document.getElementById('title').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const websiteRaw = document.getElementById('website').value;

            const websiteList = websiteRaw.split(',').map(link => link.trim()).filter(link => link.length > 0);
            checkValidation(name, title, phone, email, websiteRaw);
            const websiteHTML = websiteList.map(link => {
                const safeLink = link.startsWith('http://') || link.startsWith('https://') ? link : 'https://' + link;
                return `<a href="${safeLink}" target="_blank" style="color:#1a73e8; text-decoration:none;">${safeLink}</a>`;
            }).join('<span style="margin: 0 4px;">/</span>');

            // Chọn loại chữ ký theo đuôi email
            let html = "";
            if (email.endsWith("@nkmc.com.vn")) {
                html = genSignatureNKCentral(name, title, phone, email, websiteHTML);
            } else if (email.endsWith("@gmail.com")) {
                html = genSignatureBlissDigital(name, title, phone, email, websiteHTML);
            } else if (email.endsWith("@nkc-company.com")) {
                html = genSignatureType3(name, title, phone, email, websiteHTML);
            } else {
                html = `<div style="color:red;">Email không thuộc các domain được hỗ trợ!</div>`;
            }

            document.getElementById('result').innerHTML = html;
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('copyStatus').innerText = '';
        }

        function copySignature() {
            const resultDiv = document.getElementById("result");

            // Tạo range để chọn HTML đã render
            const range = document.createRange();
            range.selectNodeContents(resultDiv);

            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                const successful = document.execCommand("copy");
                if (successful) {
                    document.getElementById("copyStatus").innerText = "Đã sao chép!";
                } else {
                    document.getElementById("copyStatus").innerText = "Không thể sao chép.";
                }
            } catch (err) {
                document.getElementById("copyStatus").innerText = "Lỗi sao chép.";
            }

            selection.removeAllRanges();
        }

        function defaultStyleWarning(name, title, phone, email, websiteRaw) {
            document.getElementById('warning-name').style.display = 'none';
            document.getElementById('warning-title').style.display = 'none';
            document.getElementById('warning-phone').style.display = 'none';
            document.getElementById('warning-email').style.display = 'none';
            document.getElementById('warning-website').style.display = 'none';
        }

        function checkValidation(name, title, phone, email, websiteRaw) {
            if (name === "") {
                document.getElementById('warning-name').style.display = 'block';
            }
            if (title === "") {
                document.getElementById('warning-title').style.display = 'block';
            }
            if (phone === "") {
                document.getElementById('warning-phone').style.display = 'block';
            }
            if (email === "") {
                document.getElementById('warning-email').style.display = 'block';
            }
            if (websiteRaw === "") {
                document.getElementById('warning-website').style.display = 'block';
            }
        }

        // ONCHANGE PHONE ==> 
        function onChangePhone(value) {
            const phoneValue = value.trim();
            const warningPhone = document.getElementById('warning-phone');
            if (phoneValue === "") {
                warningPhone.style.display = 'block';
                warningPhone.innerText = "lưu ý thông tin SĐT chưa điền";
            }
            warningPhone.style.display = 'none';
            const phoneRegex = /^0\d{9}$/;

            if (phoneValue !== "" && !phoneRegex.test(phoneValue)) {
                warningPhone.style.display = 'block';
                warningPhone.innerText = "Số điện thoại không hợp lệ. Vui lòng nhập đúng 10 chữ số và bắt đầu bằng 0.";
            }
            generate();
        }

        // ONCHANGE MAIL ==> 

        function onChangeEmail(value) {
            const mailValue = value.trim();
            const warningEmail = document.getElementById('warning-email');
            if (mailValue === "") {
                warningEmail.style.display = 'block';
                warningEmail.innerText = "lưu ý thông tin Email chưa điền";
            }
            warningEmail.style.display = 'none';
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (mailValue !== "" && !emailRegex.test(mailValue)) {
                warningEmail.style.display = 'block';
                warningEmail.innerText = "Vui lòng nhập đúng định dạng email.";
            }
            generate();
        }
        // ONCHANGE NAME ==> 

        function onChangeName(value) {
            const nameValue = value.trim();
            const warningName = document.getElementById('warning-name');
            if (nameValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Họ tên chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        // ONCHANGE TITLE ==> 
        function onChangeTitle(value) {
            const titleValue = value.trim();
            const warningName = document.getElementById('warning-title');
            if (titleValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Chức danh chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        // ONCHANGE WEBSITE ==> 
        function onChangeWebsite(value) {
            const websiteValue = value.trim();
            const warningName = document.getElementById('warning-website');
            if (websiteValue === "") {
                warningName.style.display = 'block';
                warningName.innerText = "lưu ý thông tin Website chưa điền";
            }
            warningName.style.display = 'none';
            generate();
        }

        function genSignatureNKCentral(name, title, phone, email, websiteHTML) {
            return `
                <table cellpadding="0" cellspacing="0" border="0"
                    style="width:100%; max-width:600px; font-family:Arial, sans-serif; font-size:14px; color:#333; border-collapse:collapse;">
                <tr>
                    <td align="center" valign="middle" style="padding-right:15px; width:100px;">
                    <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/Logo_NK.png"
                        alt="NKC Logo" style="max-width:100px; height:auto; display:block; pointer-events:none; user-select:none;">
                    </td>
                    <td valign="middle" style="border-left:1px solid #fade70; padding-left:15px;">
                        <div style="font-size:17px; font-weight:bold; color:#646464;">${name}</div>
                        <div style="font-size:14px; color:#646464; margin-bottom:10px; margin-top:6px; font-weight:bold">${title}</div>

                        <div style="margin-bottom:6px;">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/phone.png"
                                alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                            <a href="tel:${phone}" style="color:#1a73e8; text-decoration:none;">${phone}</a>
                        </div>

                        <div style="margin-bottom:6px;">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/email.png"
                                alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                            <a href="mailto:${email}" style="color:#1a73e8; text-decoration:none;">${email}</a>
                        </div>


                        <div style="margin-bottom:6px; display: flex; align-items: center; flex-wrap: wrap;">
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/main/web-icon.png"
                                alt="Website" style="height:14px; vertical-align:middle; margin-right:6px; flex-shrink:0;">
                            <div style="display:inline; word-break: break-all;margin-left:6px">${websiteHTML}</div>
                        </div>

                        <div>
                            <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/location.png"
                                alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                            <a href="https://maps.google.com/?q=No. 22, D7 Street, Saigon Pearl Villa Area, Thanh My Tay Ward, Binh Thanh District, Ho Chi Minh City" target="_blank" style="color:#1a73e8; text-decoration:none;">
                                No. 22, D7 Street, Saigon Pearl Villa Area, Thanh My Tay Ward, Binh Thanh District, Ho Chi Minh City
                            </a>
                        </div>

                    </td>
                </tr>
                </table>`;
        }

        function genSignatureBlissDigital(name, title, phone, email, websiteHTML) {
            return `
                    <table cellpadding="0" cellspacing="0" border="0"
                        style="width:100%; max-width:600px; font-family:Arial, sans-serif; font-size:14px; color:#333; border-collapse:collapse;">
                    <tr>
                        <td align="center" valign="middle" style="padding-right:15px; width:100px;">
                        <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/BLISS-LOGO_Official.png"
                            alt="BLISS Logo" style="max-width:100px; height:auto; display:block; pointer-events:none; user-select:none;">
                        </td>
                        <td valign="middle" style="border-left:1px solid #fade70; padding-left:15px;">
                            <div style="font-size:17px; font-weight:bold; color:#646464;">${name}</div>
                            <div style="font-size:14px; color:#646464; margin-bottom:10px; margin-top:6px; font-weight:bold">${title}</div>

                            <div style="margin-bottom:6px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/phone.png"
                                    alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                                <a href="tel:${phone}" style="color:#1a73e8; text-decoration:none;">${phone}</a>
                            </div>

                            <div style="margin-bottom:6px;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/email.png"
                                    alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                                <a href="mailto:${email}" style="color:#1a73e8; text-decoration:none;">${email}</a>
                            </div>


                            <div style="margin-bottom:6px; display: flex; align-items: center; flex-wrap: wrap;">
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/main/web-icon.png"
                                    alt="Website" style="height:14px; vertical-align:middle; margin-right:6px; flex-shrink:0;">
                                <div style="display:inline; word-break: break-all;margin-left:4px">${websiteHTML}</div>
                            </div>

                            <div>
                                <img src="https://raw.githubusercontent.com/NKC-Company/logo-nkc-asset/refs/heads/main/location.png"
                                    alt="Phone" style="height:14px; vertical-align:middle; margin-right:6px;">
                                <a href="https://maps.google.com/?q=No. 22, D7 Street, Saigon Pearl Villa Area, Thanh My Tay Ward, Binh Thanh District, Ho Chi Minh City" target="_blank" style="color:#1a73e8; text-decoration:none;">
                                    No. 22, D7 Street, Saigon Pearl Villa Area, Thanh My Tay Ward, Binh Thanh District, Ho Chi Minh City
                                </a>
                            </div>

                        </td>
                    </tr>
                    </table>`;
        }

    </script>
</body>

</html>